

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Le chargement de jeux de données (fixtures) &mdash; Zeste de Savoir 1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Zeste de Savoir 1.0 documentation" href="../index.html"/>
        <link rel="up" title="Makefile et autres outils" href="../utils.html"/>
        <link rel="next" title="Générer les PDFs des différents contenus" href="generate_pdf.html"/>
        <link rel="prev" title="Paramètrer le moteur de Captcha" href="captcha.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Zeste de Savoir
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow.html"><em>Workflow</em> et détails pratiques</a></li>
<li class="toctree-l1"><a class="reference internal" href="../back-end.html">Le <em>back-end</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../back-end-code.html">Documentation technique du <em>back-end</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../front-end.html">Le <em>front-end</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../utils.html">Makefile et autres outils</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="0-makefile.html">Makefile</a></li>
<li class="toctree-l2"><a class="reference internal" href="anonym_dislikes.html">Anonymisation des +/-1</a></li>
<li class="toctree-l2"><a class="reference internal" href="captcha.html">Paramètrer le moteur de Captcha</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Le chargement de jeux de données (fixtures)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#les-donnees-serialisables-pour-une-base-fonctionnelle">Les données sérialisables pour une base fonctionnelle</a></li>
<li class="toctree-l3"><a class="reference internal" href="#les-donnees-complexes-voire-les-scenarios">Les données complexes voire les scénarios</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tester-sur-un-jeu-de-donnees-massif">Tester sur un jeu de données massif</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="generate_pdf.html">Générer les PDFs des différents contenus</a></li>
<li class="toctree-l2"><a class="reference internal" href="git-pre-hook.html">Détection automatique des erreurs <em>flake8</em> avec Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="opensearch.html">Installer un plugin de recherche à votre navigateur</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_generator.html">Générer les rapports de release</a></li>
<li class="toctree-l2"><a class="reference internal" href="selenium.html">Selenium</a></li>
<li class="toctree-l2"><a class="reference internal" href="tox.html">Tox</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Zeste de Savoir</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../utils.html">Makefile et autres outils</a> &raquo;</li>
        
      <li>Le chargement de jeux de données (fixtures)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/utils/fixture_loaders.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="le-chargement-de-jeux-de-donnees-fixtures">
<h1>Le chargement de jeux de données (fixtures)<a class="headerlink" href="#le-chargement-de-jeux-de-donnees-fixtures" title="Permalink to this headline">¶</a></h1>
<p>Zeste de savoir étant un projet très complet il est nécessaire de pouvoir charger un ensemble de jeux de données
de manière automatique pour créer une nouvelle instance à des fins de test ou pour forker le site.</p>
<p>Pour faciliter la tâche, trois outils sont mis à disposition des développeurs, testeurs et utilisateurs.</p>
<div class="section" id="les-donnees-serialisables-pour-une-base-fonctionnelle">
<h2>Les données sérialisables pour une base fonctionnelle<a class="headerlink" href="#les-donnees-serialisables-pour-une-base-fonctionnelle" title="Permalink to this headline">¶</a></h2>
<p>Un premier ensemble de données simples est accessible par la commande intégrée à django <code class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">loaddata</span></code>.</p>
<p>Cette commande s’attend à une liste de fichier au format yaml et supporte les <em>wildcards</em>.
Nous possédons un ensemble de données sérialisées dans le dossier fixtures:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">categories.yaml</span></code> : contient le chargement de 3 catégories de tutoriels, 2 sous catégories de tutoriels rangées dans les bonnes catégories parentes</li>
<li><code class="docutils literal"><span class="pre">forums.yaml</span></code> : contient le chargment de 4 catégories de forum et de 10 forums dans ces catégories</li>
<li><code class="docutils literal"><span class="pre">licences.yaml</span></code> : contient le chargement de 2 licences dont la licence par défaut (tous droit réservés)</li>
<li><code class="docutils literal"><span class="pre">mps.yaml</span></code> : <strong>nécessite le chargement des users</strong>, contient la création d’un MP d’un membre à un admin</li>
<li><code class="docutils literal"><span class="pre">topics.yaml</span></code>: <strong>nécessite le chargement des users</strong>, contient la création de plusieurs topics dans les forums dont un résolu</li>
<li><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">users.yaml</span></code>: Crée 6 utilisateurs:</dt>
<dd><ul class="first last">
<li>admin/admin avec les droits d’administration</li>
<li>staff/staff faisant partie du groupe staff</li>
<li>user/user un utilisateur normal et sans problème</li>
<li>ïtrema/ïtrema un utilisateur normal, sans problème mais qui aime l’utf8</li>
<li>Anonymous/anonymous : le compte d’anonymisation</li>
<li>External/external: le compte pour accueillir les cours externes des auteurs ne voulant pas devenir membre ou quittant le site</li>
<li>decal/decal: le compte qui possède un identifiant <code class="docutils literal"><span class="pre">Profile</span></code> différent de l’identifiant <code class="docutils literal"><span class="pre">user</span></code> pour permettre de tester des cas ou ces id sont différents</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>De ce fait, le moyen le plus simple de charger l’ensemble des données de base est la commande <code class="docutils literal"><span class="pre">make</span> <span class="pre">fixtures</span></code>.</p>
</div>
<div class="section" id="les-donnees-complexes-voire-les-scenarios">
<h2>Les données complexes voire les scénarios<a class="headerlink" href="#les-donnees-complexes-voire-les-scenarios" title="Permalink to this headline">¶</a></h2>
<p>Certaines données, pour exister, ont besoin de ressources supplémentaires qui ne sont pas forcément sérialisables.
Par exemple un tutoriel a besoin d’un dépôt git, une option d’aide (ZEP 03) a besoin d’une icône qui sera accessible depuis
le web…</p>
<p>Ces données ont besoin d’être traitées par une routine avant d’être créées. Ces routines existent déjà dans les objets
appelés Factory qui sont dans chacun des fichiers <code class="docutils literal"><span class="pre">factories.py</span></code> de tous les modules.</p>
<p>Pour utiliser ces fabriques d’objet, vous aurez une nouvelle fois recours au format yaml afin de décrire les
fabriques que vous désirez utiliser ainsi que les paramètres à envoyer auxdites fabriques.</p>
<p>Le format du fichier est celui-ci:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span>   <span class="l l-Scalar l-Scalar-Plain">factory</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">zds.module.factories.YourFactory</span>
    <span class="l l-Scalar l-Scalar-Plain">fields</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">champ_string</span><span class="p p-Indicator">:</span> <span class="s">&quot;valeur1&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">champ_int</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>

<span class="p p-Indicator">-</span>   <span class="l l-Scalar l-Scalar-Plain">factory</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">zds.utils.factories.YourFactory</span>
    <span class="l l-Scalar l-Scalar-Plain">fields</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">champ_string</span><span class="p p-Indicator">:</span> <span class="s">&quot;valeur2&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">champ_int</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
</pre></div>
</div>
<p>Les fichiers de factory déjà existant sont rangés dans le dossier <code class="docutils literal"><span class="pre">fixtures/advanced</span></code>.</p>
<p>Pour utiliser un fichier yaml de factory, il vous suffit de lancer la commande <code class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">load_factory_data</span> <span class="pre">chemin_vers_vos_fichier.yaml</span></code>.
Cette méthode est compatible avec les <em>wildcards</em>.</p>
<p>Pour utiliser les factories, il vous faudra vous référer à la documentation de ces dernières puisque les champs associés peuvent
être de deux types :</p>
<ul class="simple">
<li>les champs de base qui sont aussi présents avec la même orthographe dans le modèle de données</li>
<li>les champs personnalisés qui sont faits pour indiquer des comportements complémentaires à la commande
par exemple, avec la zds.utils.HelpWrittingFactory, utiliser <code class="docutils literal"><span class="pre">fixture_image_path</span></code> vous permettra de renseigner le chemin relatif de l’image dans le dossier <code class="docutils literal"><span class="pre">fixtures</span></code> plutôt que le chemin absolu.</li>
</ul>
<p>Bien que ce module soit optionnel, si vous désirez qu’il soit possible de demander de l’aide sur les tutoriels et articles,
il vous faudra utiliser <code class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">load_factory_data</span> <span class="pre">fixtures/advanced/aide_tuto_media.yaml</span></code>.</p>
</div>
<div class="section" id="tester-sur-un-jeu-de-donnees-massif">
<h2>Tester sur un jeu de données massif<a class="headerlink" href="#tester-sur-un-jeu-de-donnees-massif" title="Permalink to this headline">¶</a></h2>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">L’utilisation de la commande qui suit peut prendre du temps</p>
</div>
<p>Afin de tester avec un jeu de données qui se rapproche le plus possible de ce qui peut se trouver en exploitation, et aussi
trouver une variété suffisante pour être confiant en vos tests, nous avons développé une commande qui génère une immense
quantité de données.</p>
<p>Pour l’utiliser il suffit de lancer <code class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">load_fixtures</span> <span class="pre">--size=SIZE</span> <span class="pre">--all</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Vous pouvez ajouter <code class="docutils literal"><span class="pre">--racine</span></code> qui permet de changer la base pour le nommage des utilisateurs (« user » par défaut).
Vous pouvez ne créer les éléments que d’un module précis (ou de quelques-uns) via des options telles que <code class="docutils literal"><span class="pre">--forum</span></code>.
Ces options ne sont pas utilisables quand <code class="docutils literal"><span class="pre">--all</span></code> est ajouté.</p>
</div>
<p>Les types à charger sont en fait les modèles de données qui seront créés.</p>
<p>Chaque modèle de données aura son propre <em>coefficient de création</em> c’est à dire le nombre d’éléments qui seront créés de base.
Ce coefficient sera à multiplier par le <em>coefficient de taille</em> dirrigé par :</p>
<ul class="simple">
<li>size=low : <em>coefficient de taille</em> = 1</li>
<li>size=medium: <em>coefficient de taille</em> = 2</li>
<li>size=high: <em>coefficient de taille</em> = 3</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="36%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Modèles créés</th>
<th class="head"><em>coefficient de création</em></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>member</td>
<td>Profile (simple membres)</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>staff</td>
<td>Profile (avec droit de staff)</td>
<td>3</td>
</tr>
<tr class="row-even"><td rowspan="2">gallery</td>
<td>Gallery/UserGallery (au hasard)</td>
<td>1 (par user)</td>
</tr>
<tr class="row-odd"><td>Image</td>
<td>3 (par gallery)</td>
</tr>
<tr class="row-even"><td>category_forum</td>
<td>forum.Category</td>
<td>4</td>
</tr>
<tr class="row-odd"><td rowspan="3">category_content</td>
<td>Licence</td>
<td>Plusieurs <a class="footnote-reference" href="#lic" id="id1">[1]</a></td>
</tr>
<tr class="row-even"><td>utils.Category</td>
<td>5</td>
</tr>
<tr class="row-odd"><td>utils.SubCategory</td>
<td>10</td>
</tr>
<tr class="row-even"><td>forum</td>
<td>utils.Forum</td>
<td>8</td>
</tr>
<tr class="row-odd"><td>tag</td>
<td>Tag</td>
<td>30</td>
</tr>
<tr class="row-even"><td>topic</td>
<td>Topic (dont <em>sticky</em> et <em>locked</em>)</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>post</td>
<td>Post</td>
<td>20 (par topic) <a class="footnote-reference" href="#moy" id="id2">[3]</a></td>
</tr>
<tr class="row-even"><td>comment</td>
<td>ContentReaction</td>
<td>20 (par contenu) <a class="footnote-reference" href="#moy" id="id3">[3]</a></td>
</tr>
<tr class="row-odd"><td>tutorial et article</td>
<td>PublishableContent <a class="footnote-reference" href="#cv2" id="id4">[2]</a></td>
<td>10</td>
</tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="lic" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Les licences suivantes seront créée : “CB-BY”, “CC-BY-ND”, “CC-BY-ND-SA”, “CC-BY-SA”, “CC”, “CC-BY-IO” et “Tout-Droits”</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="cv2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[2]</a></td><td>C’est à dire 60% en validation (dont 20% réservés) et 30% publiés. S’il sagit de tutoriels, 50% de petits, 30% de moyen et 20% de <em>bigs</em>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="moy" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[3]</td><td><em>(<a class="fn-backref" href="#id2">1</a>, <a class="fn-backref" href="#id3">2</a>)</em> Ce nombre est une moyenne, le nombre réel est choisi au hasard autour de cette moyenne</td></tr>
</tbody>
</table>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="generate_pdf.html" class="btn btn-neutral float-right" title="Générer les PDFs des différents contenus" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="captcha.html" class="btn btn-neutral" title="Paramètrer le moteur de Captcha" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, zestedesavoir.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>